%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 01
% ================================================================================
\begin{frame}[t]

\mytitle{Why Emulators in Numerical Weather Prediction?}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.5\textwidth}

\vspace{-2mm}
\includegraphics[width=6cm]{../../images/img17/nwp.png}

\footnotesize
\begin{itemize}
  \item High-resolution NWP is \\ \y{computationally expensive}
  \item Many applications do not require \\ full physical fidelity
  \item Fast forecasts enable \y{new applications} \\ and scale
\end{itemize}
\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\vspace{-2mm}
\textbf{Emulator concept}

\begin{itemize}
  \item Learns the forecast step: state $\rightarrow$ state
  \item Operates within an existing NWP ecosystem
  \item Preserves grids, variables, and semantics
\end{itemize}

\vspace{2mm}
\textbf{Goal of this lecture}

\begin{itemize}
  \item Understand emulator-based AI systems
  \item Compare AIFS and AICON
  \item Walk through AICON step by step
\end{itemize}

\vspace{2mm}
\footnotesize
\rtext{\bf Emulators complement numerical models — they do not replace physical understanding.}

\end{column}

\end{columns}



\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 02
% ================================================================================
\begin{frame}[t,fragile]

\mytitle{Big-Tech AI Weather Models: Architectural Landscape}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{GraphCast (Google DeepMind)}

\begin{itemize}
  \item \y{Graph Neural Network (GNN)}
  \item Icosahedral grid, $\sim$0.25$^\circ$
  \item Multi-mesh message passing
  \item Deterministic medium-range forecasts
\end{itemize}

\vspace{4mm}
\textbf{GenCast (Google DeepMind)}

\begin{itemize}
  \item \y{Diffusion model on graphs}
  \item Icosahedral grid, $\sim$1$^\circ$–0.25$^\circ$
  \item Probabilistic forecasting
  \item Explicit uncertainty representation
\end{itemize}



\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{Pangu-Weather (Huawei)}

\begin{itemize}
  \item \y{3D Transformer architecture}
  \item Regular lat--lon grid, $\sim$0.25$^\circ$
  \item Attention over space and vertical levels
  \item Image-like representation of atmosphere
\end{itemize}

\vspace{4mm}
\textbf{FourCastNet (NVIDIA)}

\begin{itemize}
  \item \y{Fourier Neural Operator (FNO)}
  \item Regular lat--lon grid, $\sim$0.25$^\circ$
  \item Spectral convolution in Fourier space
  \item Extremely fast inference
\end{itemize}

\end{column}

\end{columns}

\vspace{2mm}
\footnotesize
\rtext{\bf All models replace the forecast step — none are embedded in classical NWP systems.}

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 03
% ================================================================================
\begin{frame}[t,fragile]

\mytitle{Research and Operational AI Weather Systems}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{Aurora (Microsoft)}

\begin{itemize}
  \item \y{Transformer-based foundation model}
  \item Regular lat--lon grids
  \item Multi-task Earth-system scope
  \item Research-driven, not NWP-native
\end{itemize}

\textbf{AIFS (ECMWF)}

\begin{itemize}
  \item Graph Neural Network (Anemoi)
  \item \y{ECMWF Flagship ML Model}
  \item Trained on ECMWF reanalysis ERA
  \item Operational global forecast system
\end{itemize}

\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{BRIS (Met Norway)}

\begin{itemize}
  \item Anemoi-based national system
  \item \y{Nested Grid Approach, high resolution}
  \item Independent training, AIFS-aligned
  \item Operational national usage
\end{itemize}

\textbf{AICON (DWD)}

\begin{itemize}
  \item Graph Neural Network (Anemoi)
  \item Native ICON triangular grid
  \item Trained on \y{ICON-DREAM reanalysis}
  \item Operational ICON emulator
\end{itemize}

\end{column}

\end{columns}

\vspace{4mm}
\footnotesize
\rtext{\bf European Meteorological Infrastructure is carrying out exciting development.}

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 04
% ================================================================================
\begin{frame}[t]

\mytitle{Anemoi based Emulators: Fields and Grids}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\centering
\footnotesize
\vspace{2mm}
\includegraphics[width=\textwidth]{../../images/img17/AICON.png}

\vspace{1mm}
Example output fields produced by the AICON emulator,
matching ICON state variables on the native grid.

\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\centering
\footnotesize
\textbf{Icosahedral Grid Representation}

\vspace{2mm}
\includegraphics[width=\textwidth]{../../images/img17/aicon_grid1.png}

\vspace{1mm}
Triangular ICON mesh used as the computational graph
for message passing and inference.

\end{column}

\end{columns}

\footnotesize
\rtext{\bf AICON learns a mapping on the ICON mesh, not on a Cartesian grid.}

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 04
% ================================================================================
\begin{frame}[t,fragile]

\mytitle{AICON Walkthrough: Environment Setup}

\vspace{-1mm}
\centering
{\color{blue}\bf Thanks to {\sl Florian Prill} for a great Notebook!}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{Core ML stack}

\begin{itemize}
  \item Python $\ge$ 3.10
  \item PyTorch (CPU or CUDA)
  \item PyTorch Lightning
  \item PyTorch Geometric (PyG)
\end{itemize}

\textbf{Anemoi framework}

\begin{itemize}
  \item \texttt{anemoi-core} (graphs, models, training)
  \item \texttt{anemoi-datasets} (Zarr + YAML I/O)
  \item \texttt{anemoi-inference} (generic inference)
  \item Supporting packages (e.g. transforms)
\end{itemize}

\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{Data and configuration}

\begin{itemize}
  \item Zarr (chunked training data)
  \item Xarray (inspection and analysis)
  \item eccodes + earthkit (GRIB2 handling)
  \item Hydra / OmegaConf (YAML configuration)
\end{itemize}

\textbf{Recommended setup}

\begin{itemize}
  \item Pinned \texttt{requirements.txt}
  \item Virtual environment or container
  \item Consistent library versions
\end{itemize}

\end{column}

\end{columns}

\vspace{4mm}
\footnotesize
\rtext{\bf Reproducibility depends on a stable, fully controlled software environment.}

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 06
% ================================================================================
\begin{frame}[t,fragile]

\mytitle{AICON Walkthrough: Manual Setup (Packages and ecCodes)}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.42\textwidth}
\footnotesize

\vspace{-2mm}
\textbf{Install required Python packages}

\begin{codeonly}{Pinned Python environment}
# Install all required packages (version!)
%pip install --no-cache-dir -U -r ../requirements.txt

# Inspect installed versions
!pip freeze
\end{codeonly}

\vspace{1mm}
Exact package versions are critical for
PyTorch, PyG, Lightning, and Anemoi compatibility.

\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.56\textwidth}
\footnotesize

\vspace{-2mm}
\textbf{Configure ecCodes definitions}

\begin{minipage}{6cm}
\begin{lstlisting}
import os
from pathlib import Path

# Path to ICON/DWD ecCodes definitions
# (provided with the repo)
edzw_defs = Path("eccodes/definitions.edzw").resolve()

# Standard ecCodes definitions (system install)
std_defs = "/path/to/eccodes/definitions"

os.environ["ECCODES_DEFINITION_PATH"] = \
    f"{edzw_defs}:{std_defs}"
\end{lstlisting}
\end{minipage}

\vspace{1mm}
\color{darkgreen}
ICON GRIB decoding requires extended
definition tables beyond standard ecCodes.

\end{column}

\end{columns}


\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 07
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{The Anemoi + AICON Hands-On Emulator Training}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17 — Slide 08
% ================================================================================
\begin{frame}[t,fragile]

\mytitle{AICON Walkthrough: Notebook Initialization}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.48\textwidth}
\footnotesize

\textbf{Jupyter and runtime setup}

\begin{codeonly}{Notebook basics}
% Enable autoreload for iterative development
%load_ext autoreload
%autoreload 2

# Standard imports
import os
import numpy as np
import torch
\end{codeonly}

\vspace{1mm}
Ensures code changes are picked up
and the runtime environment is visible.

\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.51\textwidth}
\footnotesize

\textbf{Determinism and sanity checks}

\begin{codeonly}{Reproducibility checks}
# Fix random seeds
torch.manual_seed(42)
np.random.seed(42)

# Check PyTorch device
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
print("Using device:", device)
\end{codeonly}

\vspace{1mm}
Deterministic behavior is essential
for debugging and scientific comparison.

\end{column}

\end{columns}

\footnotesize
\rtext{\bf Initialization is not boilerplate — it defines the experimental contract.}

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 09
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 09}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 10
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 10}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 11
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 11}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 12
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 12}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 13
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 13}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 14
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 14}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 15
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 15}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 16
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 16}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 17
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 17}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 18
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 18}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 19
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 19}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 20
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 20}

  % Content goes here

\end{frame}
%!TEX root = lec17.tex
% ================================================================================
% Lecture 17, Slide 21
% ================================================================================
\begin{frame}[t,fragile]
  \mytitle{Lecture 17 — Slide 21}

  % Content goes here

\end{frame}
% ================================================================================
% Slide 22 — FRAIM ecosystem graphic (Library + Apps + DAWID)
% ================================================================================
\begin{frame}[t]
\mytitle{FRAIM Ecosystem: Central Library, FRAIM-Apps, and DAWID Platform}

\centering
\vspace{mm}

% requires:
% \usepackage{tikz}
% \usetikzlibrary{positioning,arrows.meta}

\begin{tikzpicture}[
  scale=0.7, transform shape,
  font=\footnotesize,
  >=Latex,
  node distance=12mm,
  box/.style={rounded corners=2mm, draw=black!60, thick, align=center, inner sep=2mm},
  app/.style={box, minimum width=28mm, minimum height=10mm, fill=blue!4},
  lib/.style={box, minimum width=44mm, minimum height=16mm, fill=blue!10},
  daw/.style={box, minimum width=44mm, minimum height=16mm, fill=green!8},
  arrow/.style={->, thick, draw=black!70}
]

% ------------------------------------------------------------
% Center: FRAIM library
% ------------------------------------------------------------
\node[lib] (lib) {\textbf{FRAIM Library}\\[-0.5mm]
\scriptsize reusable modules + standards};

% ------------------------------------------------------------
% FRAIM-Apps around (examples)
% ------------------------------------------------------------
\node[app, above left=18mm and 38mm of lib]  (app1) {\textbf{FRAIM-App}\\QC / Monitoring};
\node[app, above=26mm of lib]                (app2) {\textbf{FRAIM-App}\\CBCF Aviation};
\node[app, above right=18mm and 38mm of lib] (app3) {\textbf{FRAIM-App}\\Downsampling};
\node[app, right=52mm of lib]                (app4) {\textbf{FRAIM-App}\\Text Generation};
\node[app, below=26mm of lib]                (app6) {\textbf{FRAIM-App}\\Road Weather};
\node[app, below left=18mm and 38mm of lib]  (app7) {\textbf{FRAIM-App}\\Nowcasting};
\node[app, left=52mm of lib]                 (app8) {\textbf{FRAIM-App}\\Obs Processing};

% arrows from apps to library (reuse)
\draw[arrow] (app1) -- (lib);
\draw[arrow] (app2) -- (lib);
\draw[arrow] (app3) -- (lib);
\draw[arrow] (app4) -- (lib);
\draw[arrow] (app6) -- (lib);
\draw[arrow] (app7) -- (lib);
\draw[arrow] (app8) -- (lib);

% ------------------------------------------------------------
% DAWID Platform (placed bottom-right)
% ------------------------------------------------------------
\node[daw, below right=24mm and 34mm of lib] (dawid)
{\textbf{DAWID Platform}\\[-0.5mm]
\scriptsize UI + LLMs + Function calling};

% DAWID-API link to library
\draw[arrow] (dawid.west) to[bend left=15]
  node[midway, above, sloped, font=\scriptsize]{\textbf{DAWID-API}} (lib.south east);

% DAWID link to Postprocessing (rerouted to avoid Nowcasting area)
\draw[arrow] (dawid.north) -- (app4.south);

\end{tikzpicture}

\end{frame}
% ================================================================================
% Slide — Anemoi vs. FRAIM (1/3)
% ================================================================================
\begin{frame}[t]
\mytitle{Anemoi vs.\ FRAIM — What are they about?}

\begin{columns}[T,totalwidth=\textwidth]
% ------------------------------------------------------------
\begin{column}[T]{0.49\textwidth}
\footnotesize
\textbf{Anemoi (ECMWF \& Partners)}
\begin{itemize}
\item international collaboration to build \y{ML-based forecast models}
\item \textbf{end-to-end framework} for \y{training \& inference}
\item well-defined pipeline:
\newline
datasets $\rightarrow$ graphs/models $\rightarrow$ training $\rightarrow$ inference/deploy
\item \textbf{Open Source}, pan-European community
\end{itemize}

\vspace{2mm}
\textbf{Typical question:}
\newline
\emph{How do we train and operate an ML forecasting model operationally?}
\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.49\textwidth}

\vspace{-2mm}
\footnotesize
\textbf{FRAIM (E-AI / DWD / Partners)}
\begin{itemize}
\item international collaboration focused on \y{many AI applications}
\item \textbf{method toolbox / modular framework} across a broad portfolio:
\newline
products, services, and smaller AI components
\item platform/integration view:
\y{standards, building blocks, reuse}
\item \textbf{umbrella framework} (forecasting is only one use case)
\end{itemize}

\vspace{0mm}
\textbf{Typical question:}
\newline
\emph{How do we build a modular AI ecosystem for many meteorological products and services?}
\end{column}
\end{columns}
\end{frame}
% ================================================================================
% Slide — Anemoi vs. FRAIM (2/3)
% ================================================================================
\begin{frame}[t]
\mytitle{Pipeline view: where does each framework sit?}

\footnotesize
\vspace{-1mm}

\textbf{Anemoi:} lifecycle of an ML forecast model \\
\vspace{1mm}
\begin{center}
\begin{tabular}{c c c c c}
\textbf{Data} & $\rightarrow$ & \textbf{Training} & $\rightarrow$ & \textbf{Inference/Deploy} \\
(anemoi-datasets) & & (anemoi-training) & & (operational tooling) \\
\end{tabular}
\end{center}

\vspace{3mm}
\textbf{FRAIM:} system / toolbox view across multiple AI components \\
\vspace{1mm}
\begin{center}
\begin{tabular}{c c c c c}
\textbf{Use case} & $\rightarrow$ & \textbf{Modules} & $\rightarrow$ & \textbf{Integration/Operations} \\
Forecast / Nowcast / QC / \\
DA / Postproc
& &
training, surrogates, \\
QA, LLM, etc.
& &
platform + standards \\
\end{tabular}
\end{center}

\vspace{2mm}
\textbf{Take-away:}
\newline
Anemoi is \y{forecast-model-centric}, FRAIM is \y{architecture- \& reuse-centric}.
\end{frame}
% ================================================================================
% Slide — Anemoi vs. FRAIM (3/3)
% ================================================================================
\begin{frame}[t]

\mytitle{Concrete differences and a good integration story}

\begin{columns}[T,totalwidth=\textwidth]
% ------------------------------------------------------------
\begin{column}[T]{0.54\textwidth}

\vspace{0mm}
\footnotesize
\textbf{Differences (short \& concrete)}
\begin{itemize}
\item \textbf{Scope:}
Anemoi = end-to-end ML forecasting \\
FRAIM = modular AI toolbox for many meteorological products
\item \textbf{Core artifacts:}
\begin{itemize}
\item \textbf{Anemoi:} datasets, graphs, model weights, training pipelines
\item \textbf{FRAIM:} central library + reusable modules + standards
\end{itemize}
\item \textbf{Organization principle:}
\begin{itemize}
\item Anemoi: one coherent forecasting stack
\item FRAIM: many \y{use-case driven FRAIM-Apps} (each in its own repo)
\end{itemize}
\end{itemize}
\end{column}

% ------------------------------------------------------------
\begin{column}[T]{0.45\textwidth}

\vspace{-1mm}
\footnotesize
\textbf{How does this combine well?}
\begin{itemize}
\item FRAIM can \y{integrate} mfai or Anemoi as a forecasting or processing engine
\item FRAIM then provides:
\begin{itemize}
\item product-specific pipelines (QC, DA, verification, monitoring, etc.)
\item deployment patterns and operational standards
\end{itemize}
\end{itemize}

\vspace{2mm}
\color{red}\bf
\textbf{One-liner:}
\newline
Anemoi = \emph{forecast-model factory}; \\
FRAIM = \emph{modular product ecosystem}.
\end{column}
\end{columns}
\end{frame}
% ================================================================================
% Slide 26 — DAWID as LLM Platform and Integration Layer
% ================================================================================
\begin{frame}[t]
\mytitle{DAWID — LLM Platform, Tools, and FRAIM Integration}

\begin{columns}[T,totalwidth=\textwidth]

% ------------------------------------------------------------
\begin{column}[T]{0.53\textwidth}
\vspace{-1mm}
\footnotesize

\textbf{DAWID capabilities}
\begin{itemize}
\item \textbf{LLM user interface}
\begin{itemize}
\item chat + document context (RAG)
\item role-based workflows (science / dev / ops)
\end{itemize}

\item \textbf{Function calling}
\begin{itemize}
\item controlled execution of domain functions
\item structured I/O and provenance
\end{itemize}

\item \textbf{Agents (multi-step)}
\begin{itemize}
\item plan $\rightarrow$ call tools $\rightarrow$ validate
\end{itemize}
\end{itemize}

\vspace{1mm}
\textbf{Key idea:} DAWID is the \y{interactive AI cockpit}.
\end{column}


% ------------------------------------------------------------
\begin{column}[T]{0.46\textwidth}
\vspace{-1mm}
\footnotesize

\textbf{DAWID-API integration}
\begin{itemize}
\item \textbf{Unified API} to LLMs and tools
\begin{itemize}
\item multi-LLM backends
\item tool/function endpoints
\end{itemize}

\item \textbf{Link to FRAIM-Apps}
\begin{itemize}
\item FRAIM-App $\rightarrow$ DAWID-API: reasoning + tooling
\item consistent interface across products
\end{itemize}
\end{itemize}

\vspace{2mm}
\color{red}\bf
\textbf{Take-away:}
DAWID connects \y{LLMs + tools + FRAIM-Apps}.
\end{column}

\end{columns}
\end{frame}
% ================================================================================
% E-AI Tutorial Slides
% Filename: lec17.tex
%
% Roland Potthast 2025/2026
% Licence: CC-BY4.0
% ================================================================================
\documentclass[aspectratio=169]{beamer}

% --- Load lecture macros --------------------------------------------------------
\input{../lec_macros.tex}
\newcommand{\LectureNumber}{Lecture 17}

% --- Document -------------------------------------------------------------------
\begin{document}

\input{../lec_agenda.tex}
\input{lec17_01.tex}
\input{lec17_02.tex}
\input{lec17_03.tex}
\input{lec17_04.tex}
\input{lec17_05.tex}
\input{lec17_06.tex}
\input{lec17_07.tex}
\input{lec17_08.tex}
\input{lec17_09.tex}
\input{lec17_10.tex}
\input{lec17_11.tex}
\input{lec17_12.tex}
\input{lec17_13.tex}
\input{lec17_14.tex}
\input{lec17_15.tex}
\input{lec17_16.tex}
\input{lec17_17.tex}
\input{lec17_18.tex}
\input{lec17_19.tex}
\input{lec17_20.tex}
\input{lec17_21.tex}
\input{lec17_22.tex}
\input{lec17_23.tex}
\input{lec17_24.tex}
\input{lec17_25.tex}
\input{lec17_26.tex}

% --- End Document ---------------------------------------------------------------
\end{document}
